#! /bin/sh -e

INCDIR=@INCLUDEDIR@
MBINDIR=@MBINDIR@

inst32()
{
  if [ -f "$MBINDIR/ustr-import-32" ]; then
    "$MBINDIR/ustr-import-32" "$@"
  
    # This assume an installed multilib ustr-conf.h
    [ $RETVAL -eq 0 ] && mv ustr-conf.h ustr-conf-32.h
    [ $RETVAL -eq 0 ] && cp "$INCDIR/ustr-conf.h" .
    [ $RETVAL -eq 0 ] && mv ustr-conf-debug.h ustr-conf-debug-32.h
    [ $RETVAL -eq 0 ] && cp "$INCDIR/ustr-conf-debug.h" .
    exit $RETVAL
  fi
}

inst64()
{
  if [ -f "$MBINDIR/ustr-import-64" ]; then
    "$MBINDIR/ustr-import-64" "$@"
    RETVAL=$?
    # This assume an installed multilib ustr-conf.h
    [ $RETVAL -eq 0 ] && mv ustr-conf.h ustr-conf-64.h
    [ $RETVAL -eq 0 ] && cp "$INCDIR/ustr-conf.h" .
    [ $RETVAL -eq 0 ] && mv ustr-conf-debug.h ustr-conf-debug-64.h
    [ $RETVAL -eq 0 ] && cp "$INCDIR/ustr-conf-debug.h" .
    exit $RETVAL
  fi
}

if [ "x$1" = "x--32" ]; then
  shift
  inst32 $@
fi

if [ "x$1" = "x--64" ]; then
  shift
  inst64 $@
fi

inst64 $@
inst32 $@

exit 1
