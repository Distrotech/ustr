2007-06-13  James Antill  <james@and.org>

	* ustr-io-code.h (ustr_io_get): Change the API to possibly return the 
	number of bytes read.

	* examples/hexdump.c (hexdump): Fix off by one typo: > should be >=
	(main): Add - files.
	(usage): Fix usage.
	(loop): Don't read again, if we've hit EOF.

2007-06-12  James Antill  <james@and.org>

	* examples/hexdump.c (main): Change read size and allow stdin reading.

	* examples/hexdump.c (hexdump): Added new example.

	* examples/netstr.c: Remove fake compat. IO for ustr-0.99.1.

	* examples/hello_world.c: Remove fake compat. IO for ustr-0.99.1.

2007-06-11  James Antill  <james@and.org>

	* ustr-main.h (ustr_xi__embed_val_get)
	(ustr_xi__ref_get, ustr_xi__pow2): Rename functions.

	* libustr.ver: Fixup ustr__ exported functions to be ustr_xi__

	* libustr.ver: Added symbols to export map.

	* scripts/list_functions_src.pl: Added io and utf8 files to list.

	* ustr-utf8-code.h (ustr_utf8_chars2bytes): Deal with zero length input.

	* ustr-spn.h (ustr_utf8_spn_cstr_fwd, ustr_utf8_spn_cstr_rev)
	(ustr_utf8_cspn_cstr_fwd, ustr_utf8_cspn_cstr_rev)
	(ustr_utf8_spn_fwd, ustr_utf8_spn_rev, ustr_utf8_cspn_fwd)
	(ustr_utf8_cspn_rev): Added functions.

	* ustr-spn-opt-code.c: Add utf8 externs.

	* ustr-spn-dbg-code.c: Add utf8 externs.

	* ustr-debug.h: Move utf8 in front of spn, as ustr-import does.

	* ustr.h: Move utf8 in front of spn, as ustr-import does.

	* ustr-spn-code.h (ustr_utf8_spn_chrs_fwd)
	(ustr_utf8_spn_chrs_rev, ustr_utf8_cspn_chrs_fwd)
	(ustr_utf8_cspn_chrs_rev): Fixes for bad utf-8.

	* ustr-utf8-code.h (ustr_utf8_len): Use the same logic as
	ustr__utf8_prev / next. Add pointer to Wikipedia documentation on utf8.
	(ustr__utf8_next): Rename from _nxt.
	(ustr__utf8_prev): Rename from _beg.
	(ustr_utf8_bytes2chars): Added function.

2007-06-10  James Antill  <james@and.org>

	* ustr-spn-code.h (ustr_utf8_spn_chrs_fwd)
	(ustr_utf8_spn_chrs_rev, ustr_utf8_cspn_chrs_fwd)
	(ustr_utf8_cspn_chrs_rev): Added functions. UTF-8 compatible spanning.

	* ustr-srch-internal.h: Create internal file, so we can use 
	USTR__SYS_MEM internally.

	* ustr-utf8-code.h (ustr_utf8_len): Use hardwired code, for
	code decrease / speed increase.

	* ustr-srch-code.h (ustr__sys_memmem): Changed to an internal symbol.

2007-06-08  James Antill  <james@and.org>

	* ustr-utf8-code.h (ustr_utf8_chars2bytes): Added function.

	* libustr.ver: Add local matches.

2007-06-07  James Antill  <james@and.org>

	* ustr-utf8-code.h (ustr__utf8_check): Fix major "porting" typo, tests
	are good!

	* ustr-utf8-internal.h (USTR__UTF8_WCHAR): Remove dep. on wchar.h for
	wchar_t ... use our own "wchar" that is unsigned and 32 bits.

2007-06-04  James Antill  <james@and.org>

	* Documentation/functions.txt: Add some more functions.

	* ustr-main.h (ustr_pool_sys_malloc, ustr_pool_sys_realloc): Add NONULL
	attribute to pool pointer argument.
	(ustr_pool_sys_free): Fix NONULL argument on data pointer.
	(ustr_pool_sys_realloc): Change behaviour to be like realloc() for
	zero length cases.

	* ustr-main-code.h (ustr_dup): Fix dupx'ing.
	(ustrp__del): Fix dmpx_cmp/ing.
	(ustrp__dupx): Fix dupx'ing.
	(ustrp__dup_subustr): Fix dupx'ing.
	(ustr_add_undef): Fix dupx'ing.
	(ustrp__add): Fix dupx'ing.
	(ustrp__sc_dup): Fix dupx'ing.
	(ustrp__sc_ensure_owner): Fix dupx'ing.

	* ustr-set-code.h (ustrp__set): Remove defunct DUPX_DEF.
	(ustrp__set_undef): Remove defunct DUPX_DEF.
	(ustrp__set_empty): Remove defunct DUPX_DEF.

	* ustr-io-code.h (ustrp__io_put): Remove defunct DUPX_DEF.

	* ustr-main-internal.h (USTR__DUPX_FROM): Change macro so it works for
	everything, preserves enomem etc.

	* ustr-cmp.h (ustr_cmp_prefix_buf_eq, ustr_cmp_prefix_eq)
	(ustr_cmp_prefix_cstr_eq, ustr_cmp_suffix_buf_eq)
	(ustr_cmp_suffix_eq, ustr_cmp_suffix_cstr_eq): Add functions.

	* scripts/git-push-web.sh: Add script.

	* ustr-utf8.h (ustr_utf8_valid): Added function.

	* ustr-utf8-code.h (ustr_utf8_len): Added function.
	(ustr_utf8_width): Added function.

	* ustr-io-internal.h: Fix #define protection C&P error.

	* Documentation/index.html: Fixup documention for examples.

2007-06-03  James Antill  <james@and.org>

	* NEWS: Release 0.99.2.

2007-06-03  James Antill  <james@and.org>

	* Documentation/index.html: Fix HREF as well as title

	* ustr-import.in: Split *-code.h and *-opt-code.c / *-dbg-code.c. Also
	fix non-cfile imports.

	* scripts/clean.sh: Remove .git data

	* libustr.ver: Fix typo

	* Makefile (SRC_SRCS): Install ustr-b-code.h, to help people make
	readable Makefiles

	* examples/Makefile: Import a bunch of stuff from top level Makefile
	to show people how to do it.

	* Makefile (all): Fix make all to build opt static libs.

	* Makefile (install): Fix install of man pages.

	* Documentation/index.html: Update link to 0.99.2

	* Makefile (SRC_SRCS): Install ustr-io-internal.h

	* Makefile (install): Fix install permissions for ustr-import.

	* ustr-debug.pc: Update for 0.99.2 release.

	* ustr.pc: Update for 0.99.2 release.

	* libustr.ver: Update for new symbols.

	* Documentation/index.html: Add link to functions/constatns API
	references.

	* Makefile (install): Install examples and html / man page API
	references.

	* examples/hello_world.c (main): Added very simple example.

	* examples/netstr.c (cescape_decode): Add options for various stuff, 
	add a cescape_decode() function.

	* examples/Makefile (LDFLAGS): Change default CFLAGS/LDFLAGS to use
	installed libustr.a/ustr.h.

	* ustr-io.h (ustr_io_putfileline):  Add function.
	(ustrp_io_putfileline):  Add function.

	* ustr-io-code.h (ustr_io_putline): Add function.
	(ustrp_io_putline): Add function.

2007-06-02  James Antill  <james@and.org>

	* Documentation/index.html: Add info. about development tree.

2007-06-01  James Antill  <james@and.org>

	* Documentation/constants.txt: Start documentation on constants.

	* Documentation/functions.txt: Start documentation on functions.

	* Documentation/txt2man.pl: Import perl script from Vstr.

	* Documentation/txt2html.pl: Import perl script from Vstr.

	* ustr-srch-code.h (ustr_srch_buf_rev): Fix buf=1 using _fwd typo.

	* ustr-spn.h (ustr_spn_fwd, ustr_spn_rev): Remove _ustr and _cstr
	namespaces.
	(ustr_cspn_fwd, ustr_cspn_rev): Remove _ustr and _cstr namespaces.
	(ustr_spn_cstr_fwd, ustr_spn_cstr_rev): Remove _ustr and _cstr
	namespaces.

	* ustr-srch-code.h (ustr_srch_subustr_fwd): Add function.
	(ustr_srch_subustr_rev): Add function.

	* TODO: Remove old cntl/srch_subustr data from TODO.

	* scripts/clean.sh: Remove coverage data, and examples too.

	* examples/netstr.c (main): Add example program.

	* ustr-main.h (USTRP_SC_INIT_AUTO): Add macro.

2007-05-31  James Antill  <james@and.org>

	* ustr-main-code.h (ustrp__reallocx): Allow reallocx to "grow", as long
	as we don't have to change byte storage.
	(ustrp__add): Cleanup code.

	* ustr-import.in: Add io, gdb and cntl options.

	* ustr-main-code.h (ustr_pool_sys_malloc): Always have the latest
	allocation at the top of the list, strict FIFO now.
	(ustr_pool_sys_realloc): Allow reallocation of the "last" -- top of the
	list allocation.

	* ustr-fmt-code.h (ustrp__add_vfmt_lim): Remove bad va_copy()/va_end()
	calls on error/retard call path.
	(ustrp__dupx_vfmt_lim): Remove bad va_copy()/va_end() calls on
	error/retard call path.
	(ustrp__set_vfmt_lim):  Remove bad va_copy()/va_end() calls on
	error/retard call path.

	* ustr-main-code.h (ustr_setf_enomem_err): Change namespace from
	_set_ to _setf_, so it isn't confusing with ustr_set_fmt() etc.
	(ustr_setf_enomem_clr, ustr_setf_share, ustr_setf_owner): Dito.

	* ustr-main.h (ustr_rw): Remove function, as it's confusing with
	ustr_owner()
	(ustr_init_fixed, ustrp_init_fixed): Remove warn_unused_ret.

	* ustr-main-code.h (ustrp_init_alloc): Fix inf. recursion typo.

2007-05-30  James Antill  <james@and.org>

	* ustr-set-code.h (ustr_set_empty, ustrp_set_empty): Add functions, 
	work like add_empty.
	(ustrp__set): Add enomem on failure to dup.
	(ustrp__set_subustr): Add enomem on failure to dup.
	
	* ustr-cmp.h (ustr_cmp_fast_buf): Move function to be always inline.
	(ustr_cmp_fast): Move function to be always inline.

	* ustr-main-code.h (ustr_pool_sys_free): Add function.
	(ustr_pool_sys_realloc, ustr_pool_sys_free): Change namespace from
	"ustr_pool_api_" to "ustr_pool_sys_".
	(ustrp__del): Fix bad usage of ustr_ro() to ustr_alloc()
	(ustr__rw_add): Allow growing if byte storage size doesn't increase.
	(ustr__treat_as_buf): Allow 0 length strings.
	(ustr_sc_ensure_owner, ustrp_sc_ensure_owner): Add function, makes sure
	the string passes the ustr_owner() test.

	* ustr-import.in: Add missing compiler copy.
	
	* ustr-compiler.h: Remove COMPILE_ASSERT checks, for dynamic config.

	* tst.h (USE_MALLOC_CHECK): Explicitly define the option.
	(mc_malloc, mc_realloc, mc_free): Use the new USTR_CONF_USE_DYNAMIC_CONF
	to change the malloc cbs with ustr_cntl_opt.
	(main): Move from dup_buf() to sc_ensure_owner(), tweaks for
	malloc-check.

	* ustr-cntl-code.h (ustr_cntl_opt): Added function, allow some of the
	global config. options to be runtime vars instead.

	* ustr-cmp-code.h (ustr_cmp_subustr): Fix spurious ! C&P typo.
	(ustr_cmp_fast_subustr): Fix spurious ! C&P typo.

	* tst.h (USTR_CONF_FREE): Add file/line data.

	* malloc-check.h (malloc_check_free): Add file/line params. to free.

2007-05-28  James Antill  <james@and.org>

	* ustr-fmt.h: Add warn_unused_ret() to all dup funcs.

	* Makefile: Move all tests into seperate T dir, generate .c files
	so that coverage "does the right thing"

	* scripts/lcov.sh: Update lcov.sh to do the right thing, must be called
	from Makefile now.

	* malloc-check.h (malloc_check_assert): Use internal namespaced
	assert().
	(malloc_check_mem, malloc_check_alloc, malloc_check_sz_mem): Add
	file/line params. to other functions.
	(MALLOC_CHECK_TRACE): Add trace option.

2007-05-27  James Antill  <james@and.org>

	* ustr-io-code.h (ustrp__io_getline): Speed up getline.

	* Makefile: Fixup SONAME, change cc to be default.

2007-05-26  James Antill  <james@and.org>

	* ustr-set-code.h (ustrp__set_undef): Cleanup code.

	* ustr-io-code.h (ustrp__io_put): Don't allocate an entire new string, 
	just the bits that'll be left over.

	* Documentation/design.html: Use new USTR_BEG_FIXEDx constants in
	examples.

2007-05-25  James Antill  <james@and.org>

	* ustr-main-code.h (ustr__rw_add): Fixup tests for if we can reuse the
	current Ustr, allow lbytes to be more than the minimum needed.

	* ustr-io-code.h (ustr_io_get, ustrp_io_get)
	(ustr_io_getfile, ustrp_io_getfile, ustr_io_getfilename)
	(ustr_io_getfilename, ustrp_io_getfilename)
	(ustr_io_getline, ustrp_io_getline)
	(ustr_io_put, ustrp_io_put, ustr_io_putfilename)
	(ustrp_io_putfilename): Added simple blocking stdio IO functions.

	* ustr-fmt.h: Add USTR__COMPILE_ATTR_WARN_UNUSED_RET() to add _dup 
	format functions.

	* ustr-main.h: Remove USTR__COMPILE_ATTR_WARN_UNUSED_RET() from
	ustr_init_fixed.

	* ustr-set-internal.h: Add internal headers, to reduce obj size.

	* ustr-main.h: Add internal headers, to reduce obj size.
	(USTR_CONF_INCLUDE_INTERNAL_HEADERS): Add define on if you get internal
	header code or not.

	* ustr-main-code.h (ustr__sz_get): Fixed prototype.

	* Makefile (VERS_ESONAME): Fix the SONAME to just .0

2007-05-24  James Antill  <james@and.org>

	* ustr-import.in: Add a gdb import only mode.

	* ustr.spec: Fix typo of %{ver} to be %{version}.

	* ustr-import.in: Copy .gdbinit on import.

	* Makefile (install): Added .gdbinit to shared dir.

	* ustr.spec: Added .gdbinit to -devel package

	* Documentation/index.html: Tweaked documentation.
	* Documentation/index.html: Added link to gnumeric file
	* Documentation/index.html: Added link to .gdbinit file

	* THANKS: Added Rik and Karl.

2007-05-23  James Antill  <james@and.org>

	* NEWS: Release 0.99.1

2007-05-15  James Antill  <james@and.org>

	* tst_4_grow.c (tst): Fix for Solaris's retarded printf.
	* ctst_4_grow.c (tst): Fix for Solaris's retarded printf.
